# Fixed port Dockerfile
FROM nginx:alpine

# Copy test files
COPY apps/web/public/ /usr/share/nginx/html/

# Create health check file
RUN echo "healthy" > /usr/share/nginx/html/health.txt

# Copy nginx configuration with fixed port
COPY apps/web/nginx-fixed.conf /etc/nginx/conf.d/default.conf

# Remove default config
RUN rm -f /etc/nginx/conf.d/default.conf.dpkg-dist

# Test nginx configuration
RUN nginx -t

# Expose port 8080
EXPOSE 8080

# Start nginx
CMD ["nginx", "-g", "daemon off;"]